events {}

http {
    server {
        listen 80;
        server_name localhost;
        
        # Увеличиваем размер для загрузки файлов
        client_max_body_size 50M;
        
        location / {
            proxy_pass http://frontend:3000;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        location /api/ {
            proxy_pass http://backend-app:8080;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # Увеличиваем таймауты для обработки файлов
            proxy_read_timeout 300s;
            proxy_connect_timeout 75s;
        }

        # Прокси для Swagger UI через API
        location /api/swagger/ {
            proxy_pass http://backend-app:8080/swagger/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Прокси для ML сервиса (если нужен прямой доступ)
        ; location /ml/ {
        ;     proxy_pass http://ml:5000/;
        ;     proxy_set_header Host $host;
        ;     proxy_set_header X-Real-IP $remote_addr;
        ;     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        ;     proxy_set_header X-Forwarded-Proto $scheme;
            
        ;     # Увеличиваем таймауты для ML обработки
        ;     proxy_read_timeout 600s;
        ;     proxy_connect_timeout 75s;
        ; }
    }
}